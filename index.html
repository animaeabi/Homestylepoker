<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Game Buy-in Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500;9..144,700&family=Manrope:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="theme-dark">
    <div class="app">
      <header class="topbar">
        <div class="brand">
          <span class="brand-chip">HOME GAME</span>
          <h1>Poker Nights</h1>
          <p>If Someone’s down bad. The pot knows.</p>
        </div>
        <div class="top-actions">
          <button id="openSessions" class="primary">Recent Sessions</button>
          <button id="openGuide" class="ghost small" type="button">Guide</button>
        </div>
      </header>

      <section id="landing" class="landing">
        <div class="landing-card lets-play">
          <h2>Let’s play</h2>
          <label class="field">
            <span>Game name</span>
            <input id="newGameName" type="text" placeholder="Friday Night Hold'em" />
          </label>
          <label class="field">
            <span>Default buy-in</span>
            <small>Used for every buy-in</small>
            <input id="newBuyIn" type="number" min="1" step="1" placeholder="10" value="10" />
          </label>
          <label class="field">
            <span>Host name</span>
            <input id="newHostName" type="text" placeholder="Your name" required />
          </label>
          <label class="field">
            <span>Group (optional)</span>
            <select id="gameGroup">
              <option value="">No group (one-off)</option>
            </select>
          </label>
          <button id="createGame" class="primary">Host a game</button>
          <p class="hint">You’ll be the host for this game (can’t be changed).</p>
        </div>

        <div class="landing-card compact group-card">
          <div class="group-header">
            <h2>Groups</h2>
            <button id="createGroup" class="primary add-group-btn" type="button">+</button>
          </div>
          <div id="groupList" class="group-list"></div>
        </div>
      </section>

      <section id="configNotice" class="banner hidden">
        <div>
          <strong>Connect Supabase to continue.</strong>
          <p>Update <code>config.js</code> with your Supabase URL and anon key.</p>
        </div>
      </section>

      <section id="gamePanel" class="game hidden">
        <div class="game-bar">
          <div class="game-info">
            <div>
              <p class="eyebrow">Game</p>
              <h2 id="gameTitle">Loading…</h2>
            </div>
            <div class="info-chip">
              Code
              <strong id="gameCode">—</strong>
            </div>
            <div class="info-chip status-chip">
              Status
              <strong id="gameStatusChip">Live</strong>
            </div>
            <label class="toggle">
              <input type="checkbox" id="hostModeToggle" />
              <span>Host mode</span>
            </label>
            <button id="openSettle" class="danger-outline">Settle game</button>
          </div>
        </div>

        <section id="settledNotice" class="banner banner-danger hidden">
          <div>
            <strong>Game settled.</strong>
            <p>Settled at <span id="settledAt">—</span>. Buy-ins are locked.</p>
          </div>
        </section>

        <div class="game-layout">
          <div id="hostLayout" class="host-layout">
            <div class="host-left">
              <div id="joinPanel" class="join-panel">
                <div class="share-panel">
                  <div class="link-row">
                    <input id="joinLink" class="sr-only" type="text" readonly />
                    <button id="copyLinkInline" class="ghost">Share Link</button>
                  </div>
                  <canvas id="qrCanvas" width="140" height="140"></canvas>
                </div>
                <div class="join-card hidden">
                  <h3>Game settings</h3>
                  <label class="field">
                    <span>Game name</span>
                    <input id="gameName" type="text" />
                  </label>
                  <div class="row">
                    <label class="field">
                      <span>Currency</span>
                      <input id="currency" type="text" maxlength="3" />
                    </label>
                    <label class="field">
                      <span>Default buy-in</span>
                      <input id="defaultBuyIn" type="number" min="1" step="1" />
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="host-right">
              <section id="hostPanel" class="panel">
                <div class="panel-title">
                  <h2>Host</h2>
                  <p>Live totals as players buy in.</p>
                </div>
                <div id="summary" class="summary"></div>
                <div class="host-actions">
                  <label class="field">
                    <span>Add player (optional)</span>
                    <input id="hostPlayerName" type="text" placeholder="Player name" />
                  </label>
                  <div class="action-row">
                    <button id="hostAddPlayer" class="primary">Add player</button>
                  </div>
                </div>
                <div id="players" class="players"></div>
                <section id="settlementSummary" class="settlement-summary hidden"></section>
              </section>

              <section id="logPanel" class="panel log">
                <div class="panel-title">
                  <h2>Log</h2>
                  <p>Timestamped buy-ins.</p>
                </div>
                <div id="logTable" class="table"></div>
              </section>
            </div>
          </div>

          <section id="playerPanel" class="panel player-panel">
            <div class="panel-title" id="playerPanelTitle">
              <h2 id="playerPanelHeading">Player</h2>
              <p id="playerPanelSubtitle">Join once, tap to add buy-ins.</p>
            </div>
            <div id="playerJoin" class="player-join">
              <label class="field">
                <span>Your name</span>
                <input id="playerName" type="text" placeholder="Name" />
              </label>
              <button id="joinAsPlayer" class="primary">Join game</button>
              <div id="playerMatchList" class="match-list hidden"></div>
              <p id="playerJoinNotice" class="muted hidden">Game settled — new players are closed.</p>
            </div>
            <div id="playerSeat" class="player-seat hidden">
              <div id="playerCard" class="player-card"></div>
              <div class="player-actions">
                <button id="playerAddDefault" class="primary">Add buy-in</button>
              </div>
              <p id="playerNotice" class="muted hidden">Game settled — buy-ins are locked.</p>
              <div id="playerBuyins" class="player-buyins"></div>
            </div>
            <section id="playerSettledSummary" class="settlement-summary hidden"></section>
          </section>
        </div>
      </section>

      <section id="sessionsPanel" class="sessions hidden">
        <div class="sessions-bar">
          <div>
            <h2>Sessions</h2>
            <p class="muted">Grouped by table.</p>
          </div>
          <div class="sessions-actions">
            <button id="sessionsBack" class="ghost">Back</button>
            <button id="deleteAllGames" class="danger-outline small" type="button">Delete all</button>
          </div>
        </div>

        <div class="sessions-grid">
          <div class="landing-card">
            <h2>Sessions by group</h2>
            <div id="recentGames" class="recent-games"></div>
          </div>

          <div class="landing-card">
            <h2>Quarterly Summary</h2>
            <p class="muted">Settled games only.</p>
            <label class="field">
              <span>Group</span>
              <select id="summaryGroup"></select>
            </label>
            <label class="field">
              <span>Quarter</span>
              <select id="summaryQuarter"></select>
            </label>
            <button id="openSummary" class="ghost">View summary</button>
          </div>
        </div>
      </section>

      <div id="settleModal" class="modal hidden" role="dialog" aria-modal="true">
        <div class="modal-backdrop" data-action="close"></div>
        <section id="settlePanel" class="panel settle-panel">
          <div class="panel-title">
            <h2>Settle</h2>
            <p>Enter each player’s remaining chips. This ends the game and saves the results.</p>
          </div>
          <p id="settleError" class="form-error hidden"></p>
          <form id="settleForm" class="settle-form">
            <div id="settleList" class="settle-list"></div>
            <div class="settle-actions">
              <button id="settleCancel" type="button" class="ghost">Cancel</button>
              <button type="submit" class="primary">Save settlement</button>
            </div>
          </form>
        </section>
      </div>

      <div id="summaryModal" class="modal hidden" role="dialog" aria-modal="true">
        <div class="modal-backdrop" data-action="close"></div>
        <section class="panel summary-panel">
          <div class="panel-title summary-header">
            <div>
              <h2 id="summaryTitle">Quarterly Summary</h2>
              <p id="summarySubtitle" class="muted"></p>
            </div>
            <button id="summaryClose" class="ghost" type="button">Close</button>
          </div>
          <div id="summaryBreakdown" class="summary-breakdown"></div>
          <div id="summaryTransfers" class="summary-transfers"></div>
        </section>
      </div>

      <div id="groupModal" class="modal hidden" role="dialog" aria-modal="true">
        <div class="modal-backdrop" data-action="close"></div>
        <section class="panel group-panel">
          <div class="panel-title summary-header">
            <div>
              <h2 id="groupModalTitle">Group</h2>
              <p class="muted">Manage players in this group.</p>
            </div>
            <div class="summary-actions">
              <button id="groupRename" class="ghost compact-btn" type="button">Rename</button>
              <button id="groupDelete" class="danger-outline compact-btn" type="button">Delete</button>
              <button id="groupModalClose" class="ghost" type="button">Close</button>
            </div>
          </div>
          <div class="group-lock">
            <div>
              <strong>Lock</strong>
              <span id="groupLockStatus" class="muted">Open</span>
            </div>
            <div class="group-lock-actions">
              <button id="groupLockSet" class="ghost compact-btn" type="button">Set phrase</button>
              <button id="groupLockRemove" class="danger-outline compact-btn" type="button">Remove</button>
            </div>
          </div>
          <div id="groupPlayerList" class="group-player-list"></div>
          <form id="groupPlayerForm" class="group-player-form">
            <label class="field">
              <span>Add player</span>
              <input id="groupPlayerName" type="text" placeholder="Name" />
            </label>
            <button id="groupPlayerAdd" class="ghost" type="submit">Add player</button>
          </form>
        </section>
      </div>

      <div id="createGroupModal" class="modal hidden" role="dialog" aria-modal="true">
        <div class="modal-backdrop" data-action="close"></div>
        <section class="panel group-create-panel">
          <div class="panel-title summary-header">
            <div>
              <h2>Create group</h2>
              <p class="muted">Name this group.</p>
            </div>
            <button id="createGroupClose" class="ghost" type="button">Close</button>
          </div>
          <form id="createGroupForm" class="group-create-form">
            <label class="field">
              <span>Group name</span>
              <input id="createGroupName" type="text" placeholder="Friday Crew" />
            </label>
            <div class="roster-actions">
              <button id="createGroupCancel" class="ghost" type="button">Cancel</button>
              <button id="createGroupSubmit" class="primary" type="submit">Create group</button>
            </div>
          </form>
        </section>
      </div>

      <div id="guideModal" class="modal hidden" role="dialog" aria-modal="true">
        <div class="modal-backdrop" data-action="close"></div>
        <section class="panel guide-panel">
          <div class="panel-title summary-header">
            <div>
              <h2>Guide</h2>
              <p class="muted">How this works, plus what’s next.</p>
            </div>
            <button id="guideClose" class="ghost" type="button">Close</button>
          </div>
          <div class="guide-content">
            <h3>Quick start</h3>
            <ol>
              <li>Enter host name, pick optional group, and hit <strong>Host a game</strong>.</li>
              <li>Share the link/QR for players to join on their phones.</li>
              <li>Players tap <strong>Add buy-in</strong>. Host sees totals update live.</li>
              <li>When done, hit <strong>Settle game</strong> and enter final chips.</li>
            </ol>

            <h3>Groups</h3>
            <ul>
              <li>Groups are optional. Use them for recurring home games and quarterly summaries.</li>
              <li>Click a group name to manage players or lock the group with a phrase.</li>
              <li>Locked groups require the phrase to open or use.</li>
            </ul>

            <h3>Player flow</h3>
            <ul>
              <li>On first join, players enter their name once and are remembered on that device.</li>
              <li>After joining they see only: buy-ins, total, and a big <strong>Add buy-in</strong>.</li>
            </ul>

            <h3>Sessions &amp; summaries</h3>
            <ul>
              <li><strong>Recent Session</strong> shows past games grouped by group.</li>
              <li><strong>Quarterly Summary</strong> includes settled games only and shows who‑pays‑who.</li>
            </ul>

            <h3>Data &amp; privacy</h3>
            <ul>
              <li>This is a Supabase‑backed app. Anyone with the join link can access that game.</li>
              <li>Groups can be locked with a phrase, but there is no full login system yet.</li>
            </ul>

            <h3>Planned / optional upgrades</h3>
            <ul>
              <li>CSV export and receipts.</li>
              <li>Host/admin PIN and stricter access control.</li>
              <li>Per‑player notes and settlements history.</li>
              <li>Private accounts with Supabase Auth (if you want).</li>
            </ul>
          </div>
        </section>
      </div>

      <div id="rosterModal" class="modal hidden" role="dialog" aria-modal="true">
        <div class="modal-backdrop" data-action="close"></div>
        <section class="panel roster-panel">
          <div class="panel-title summary-header">
            <div>
              <h2 id="rosterTitle">Who's playing?</h2>
              <p class="muted">Remove anyone sitting out.</p>
            </div>
            <button id="rosterClose" class="ghost" type="button">Close</button>
          </div>
          <div id="rosterList" class="roster-list"></div>
          <div class="roster-actions">
            <button id="rosterCancel" class="ghost" type="button">Cancel</button>
            <button id="rosterStart" class="primary" type="button">Start game</button>
          </div>
        </section>
      </div>

      <footer class="footer">
        <span id="connectionStatus">Offline</span>
        <span id="saveStatus"></span>
      </footer>
    </div>

    <script type="module" src="app.js"></script>
  </body>
</html>
